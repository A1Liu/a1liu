#!/bin/sh

CFG_DIR=`pwd`
LOCAL_DIR="$LOCAL_DIR"

# Template for machine-local shell endpoints
read -r -d '' PRINT_TEMPLATE <<- EOF
#!/bin/sh

export CFG_DIR="$CFG_DIR"
CUR_SHELL="\$0"
IS_INTERACTIVE_SHELL=%s

source "$CFG_DIR/shells/dispatch"
EOF

# Sets up machine-local endpoints that can be soft-linked to while still
# maintaining flexibility
touch "$LOCAL_DIR/shell_init"
printf "${PRINT_TEMPLATE}\n" 'false' > "$LOCAL_DIR/shell_init"
touch "$LOCAL_DIR/shell_interact_init"
printf "${PRINT_TEMPLATE}\n" 'true' > "$LOCAL_DIR/shell_interact_init"

# Function to check for existing configs, and move them if necessary
check_move() {
  if [ -e "~/$1" ]; then
    mv "~/$1" "$LOCAL_DIR/$1"
  fi
  ln -s "`readlink -m ${CFG_DIR}/$2`" ~/$1
}

# Create all the soft links
ln -s "${CFG_DIR}/neovim/init.vim" ~/.vimrc
ln -s "${CFG_DIR}/neovim" ~/.vim
ln -s "${CFG_DIR}/programs/gitconfig" ~/.gitconfig
ln -s "${CFG_DIR}/programs/gitignore_global" ~/.gitignore_global
.
ln -s "$LOCAL_DIR/shell_interact_init" ~/.bashrc
ln -s "$LOCAL_DIR/shell_interact_init" ~/.profile
ln -s "$LOCAL_DIR/shell_interact_init" ~/.zshrc

